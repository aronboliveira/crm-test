# v1.4 Quick Reference - Template Creation & Security

## Quick Start

### Open Template Modal

```vue
<!-- In ClientDetailView.vue -->
<button @click="showTemplateModal = true">Adicionar Template</button>

<TemplateCreationModal
  :is-open="showTemplateModal"
  :client-id="client.id"
  @close="showTemplateModal = false"
  @submit="handleSubmit"
/>
```

### Backend Validation

```typescript
// In any controller
import { ZodValidationPipe, CreateTemplateSchema, CreateTemplateDto } from '../../common/validation';

@Post()
async create(
  @Body(new ZodValidationPipe(CreateTemplateSchema, { sanitize: true }))
  dto: CreateTemplateDto,
) {
  // dto is validated & sanitized
}
```

## Validation Limits

| Field       | Min | Max   | Pattern                    |
| ----------- | --- | ----- | -------------------------- |
| key         | 3   | 64    | `^[a-zA-Z][a-zA-Z0-9_-]*$` |
| name        | 2   | 128   | -                          |
| description | -   | 512   | -                          |
| content     | -   | 65536 | -                          |
| subject     | -   | 256   | -                          |

## Form States

| State   | `data-form-state` | Fieldset |
| ------- | ----------------- | -------- |
| Valid   | `'valid'`         | enabled  |
| Invalid | `'invalid'`       | enabled  |
| Blocked | `'blocked'`       | disabled |

## Sanitization

```typescript
// Strip all HTML
sanitizer.sanitizeText("<p>Hello</p>"); // "Hello"

// Allow safe HTML
sanitizer.sanitizeHtml("<p>Hello <script>alert(1)</script></p>"); // "<p>Hello </p>"

// Check for SQL injection
sanitizer.scanForSqlInjection("'; DROP TABLE users; --").hasSqlInjection; // true
```

## Run Tests

```bash
# Schema tests
npm test -- --testPathPatterns="template.schema"

# Sanitizer tests
npm test -- --testPathPatterns="sanitizer.service"

# All validation tests
npm test -- --testPathPatterns="common/validation"
```

## Security Checklist

- [x] Zod schema validation
- [x] DOMPurify HTML sanitization
- [x] SQL injection pattern detection
- [x] XSS pattern detection
- [x] Form blocking on invalid input
- [x] ARIA accessibility attributes
- [x] Data attributes for state tracking
